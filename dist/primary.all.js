!function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/api",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.API=t(),void 0)}(this,function(){"use strict";function e(e,t){var o;for(o in e)e.hasOwnProperty(o)&&!t.hasOwnProperty(o)&&(t[o]=e[o]);return t}function t(t){var n,r="";this._defaultParams={},this._options=e({env:"live",protocol:"http"},t||{});var s=o(this._options);for(n in s)s.hasOwnProperty(n)&&"env"!==n&&"protocol"!==n&&(this._defaultParams[n]=s[n]);"live"!==this._options.env&&(r="."+this._options.env),this._baseUri=this._options.protocol+"://open."+this._options.env+".bbc.co.uk/locator",this._palBaseUri=this._options.protocol+"://www"+r+".bbc.co.uk/locator/default",this._hasXHR="undefined"!=typeof window.XMLHttpRequest}function o(e){var t,o={};for(t in e)e.hasOwnProperty(t)&&((typeof e[t]).match(/string|number/)?o[t]=e[t]:"[object Array]"===Object.prototype.toString.call(e[t])&&(o[t]=e[t].join(",")));return o}t.prototype.getDefaultQueryParameters=function(){return this._defaultParams},t.prototype.getLocation=function(t,n){var r="",s="location";n.params=e(this._defaultParams,o(n||{})),n.detailTypes&&"[object Array]"===Object.prototype.toString.call(n.detailTypes)&&(s="details",r="/details/"+n.detailTypes.join(","),n.params.vv=2);var i="/locations/"+encodeURIComponent(t)+r;this.request(i,n,s)},t.prototype.search=function(t,n){function r(){var e=n.success,o=t,r=n.params.start;return function(t){t.metadata.search=o,r&&(t.metadata.start=r),e(t)}}n.params=e(this._defaultParams,o(n||{})),n.params.s=t,n.success=r(),this.request("/locations",n,"search")},t.prototype.autoComplete=function(t,n){n.params=e(this._defaultParams,o(n||{})),n.params.s=t,n.params.a="true",this.request("/locations",n,"autoComplete")},t.prototype.reverseGeocode=function(t,n,r){r.params=e(this._defaultParams,o(r||{})),r.params.lo=n,r.params.la=t,this.request("/locations",r,"reverseGeocode")},t.prototype.getCookie=function(e,t){t.params=t.params||{},t.params.id=e,this.request("/shared/location.json",t,"cookie")},t.prototype.request=function(e,t,o){t.params.format="json";var i,a="function"==typeof window.addEventListener?window.addEventListener:window.attachEvent,c="function"==typeof window.removeEventListener?window.removeEventListener:window.detachEvent,l=e+s(t.params),u=this,p=!1,d=function(){window.ActiveXObject&&c("onunload",v)},h=function(e){var n;try{n=_(e.responseText),setTimeout(function(){t.success(r(n,o))})}catch(s){t.error&&t.error()}},m=function(e){e.onreadystatechange=function(){4===e.readyState&&(t.success&&e.status<400&&null!==e.responseText?h(e):t.error&&t.error(),d())}},f=function(e){e.onload=function(){t.success&&null!==e.responseText?h(e):t.error&&t.error(),d()},e.onerror=function(){t.error&&t.error(),d()}},v=function(){p=!0,i.onload=i.onerror=i.onreadystatechange=null,i.abort()},g=function(e){p||"function"!=typeof t.error||t.error(e)};window.ActiveXObject&&a("onunload",v);var y=function(e){return"cookie"===o||"pal"===e?u._palBaseUri+l:u._baseUri+l},_=function(e){if(window.JSON&&window.JSON.parse)try{return window.JSON.parse(e)}catch(t){return null}return"string"==typeof e?new Function("return "+e)():null};if(this._hasXHR&&(i=new XMLHttpRequest),i&&"withCredentials"in i)try{i.open("GET",y("api"),!0),f(i)}catch(w){g(w)}else if("undefined"!=typeof window.XDomainRequest)i=new XDomainRequest,i.open("GET",y("api")),f(i);else if(i)try{i.open("GET",y("pal")),m(i)}catch(w){g(w)}else"undefined"!=typeof window.ActiveXObject?(i=new ActiveXObject("Microsoft.XMLHTTP"),i.open("GET",y("pal"),!0),m(i)):n(y("api"),t,o);if("undefined"!=typeof i)try{i.send(null)}catch(b){v(),d(),t.error&&t.error()}};var n=function(e,t,o){var n,i;i="_locservices_core_api_cb_"+(new Date).getTime()+Math.round(1e5*Math.random()),t.params.format="jsonp",t.params.jsonp=i,window[i]=function(e){try{delete window[i]}catch(s){window[i]=void 0}document.body.removeChild(n),t.success&&t.success(r(e,o))},n=document.createElement("script"),n.src=e+s(t.params),"function"==typeof t.error&&(n.onerror=t.error),document.body.appendChild(n)},r=function(e,t){var o={};switch(t){case"cookie":o=e;break;case"location":o.location=e.response;break;case"details":o.location=e.response.metadata.location,o.details=e.response.content.details.details;break;case"search":o.results=e.response.locations,o.metadata={totalResults:e.response.totalResults};break;case"autoComplete":o.results=e.response.results.results,o.metadata={totalResults:e.response.results.totalResults};break;case"reverseGeocode":o.results=e.response.results.results}return o},s=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o+"="+encodeURIComponent(e[o]));return"?"+t.join("&")};return t}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/preferred_location",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.PreferredLocation=t(),void 0)}(this,function(){"use strict";function e(e){this.api=e}var t="locserv",o="/";e.prototype.isValidLocation=function(e){var t,o;return"object"!=typeof e?!1:(t=e.placeType,o=e.country,"settlement"!==t&&"airport"!==t&&"district"!==t?!1:"GB"!==o&&"GG"!==o&&"IM"!==o&&"JE"!==o?!1:!0)},e.prototype.isSet=function(){return null!==this.getLocServCookie()},e.prototype.unset=function(){var e=this.getCookieDomain();return!1===e?!1:(this.setDocumentCookie(t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/; domain="+e+";"),!0)},e.prototype.getHostname=function(){return window.location.hostname},e.prototype.getDocumentCookie=function(){return window.document.cookie},e.prototype.setDocumentCookie=function(e){window.document.cookie=e},e.prototype.getCookieDomain=function(){var e,t;return this.cookieDomain?this.cookieDomain:(t=this.getHostname(),"string"!=typeof t?!1:(e=t.match(/bbc\.co(\.uk|m)$/),this.cookieDomain=e&&2===e.length?"."+e[0]:!1,this.cookieDomain))},e.prototype.getLocServCookie=function(){var e,o;return e=this.getDocumentCookie(),o=e.match(new RegExp(t+"=(.*?)(;|$)")),!o||o.length<2?null:o[1]},e.prototype.get=function(){var e,t,o,a,c,l;if(c=function(e){var t,o,n,r,s={};for(o=e.substr(0,1),e=e.substr(3),n=e.split(":"),t=0;t<n.length;t++)r=n[t].split("="),r[1]=r[1].replace(/\+/g,"%20"),s[r[0]]=decodeURIComponent(r[1]);return{name:o,data:s}},t=this.getLocServCookie(),!t)return null;for(e={id:null,name:null,nation:null,news:null,weather:null},o=t.substr(2).split("@"),l=0;l<o.length;l++)a=c(o[l]),"l"===a.name?(e.id=a.data.i,e.name=a.data.n,a.data.c&&(e.container=a.data.c),a.data.y&&(e.country=a.data.y),a.data.p&&(e.placeType=a.data.p),a.data.h&&(e.nation=i[a.data.h])):"w"===a.name?e.weather={id:a.data.i,name:a.data.p}:"n"===a.name&&(e.news={id:a.data.r,path:n[a.data.r],tld:s[a.data.r],name:r[a.data.r]});return e},e.prototype.set=function(e,n){var r,s=this;return n=n||{},void 0===this.api||"string"!=typeof e||""===e.replace(/^\s+|\s+$/g,"")?void("function"==typeof n.error&&n.error()):(this.cookieLocation=void 0,r=s.getCookieDomain(),!1===r&&"function"==typeof n.error&&n.error(),void this.api.getCookie(e,{success:function(e){var i,a;a=new Date(1e3*e.expires).toUTCString(),i=t+"="+e.cookie+"; ",i+="expires="+a+"; ",i+="domain="+r+"; ",i+="path="+o+";",s.setDocumentCookie(i),"function"==typeof n.success&&n.success(s.get())},error:function(e){"function"==typeof n.error&&n.error(e)}}))};var n={3:"england/berkshire",4:"england/birmingham_and_black_country",7:"england/bristol",8:"england/cambridgeshire",11:"england/cornwall",12:"england/coventry_and_warwickshire",13:"england/cumbria",16:"england/derbyshire",17:"england/devon",18:"england/dorset",19:"scotland/edinburgh_east_and_fife",20:"england/essex",22:"scotland/glasgow_and_west",23:"england/gloucestershire",26:"world/europe/guernsey",27:"england/hampshire",28:"england/hereford_and_worcester",30:"scotland/highlands_and_islands",31:"england/humberside",32:"world/europe/isle_of_man",33:"world/europe/jersey",34:"england/kent",35:"england/lancashire",36:"england/leeds_and_west_yorkshire",37:"england/leicester",38:"england/lincolnshire",39:"england/merseyside",40:"england/london",41:"england/manchester",42:"wales/mid_wales",43:"england/norfolk",44:"england/northamptonshire",45:"scotland/north_east_orkney_and_shetland",46:"wales/north_east_wales",21:"northern_ireland",47:"wales/north_west_wales",49:"england/nottingham",50:"england/oxford",57:"england/south_yorkshire",51:"england/shropshire",52:"england/somerset",53:"wales/south_east_wales",55:"scotland/south_scotland",56:"wales/south_west_wales",58:"england/stoke_and_staffordshire",59:"england/suffolk",66:"england/surrey",60:"england/sussex",61:"scotland/tayside_and_central",62:"england/tees",1:"england/beds_bucks_and_herts",63:"england/tyne_and_wear",65:"england/wiltshire",48:"england/york_and_north_yorkshire"},r={56:"South West Wales",28:"Hereford &amp; Worcester",36:"Leeds and Bradford",60:"Sussex",61:"Tayside &amp; Central Scotland",62:"Tees",63:"Tyne and Wear",35:"Lancashire",66:"Surrey",34:"Kent",26:"Guernsey",27:"Hampshire",20:"Essex",21:"Northern Ireland",48:"York &amp; North Yorkshire",49:"Nottinghamshire",46:"North East Wales",47:"North West Wales",44:"Northampton",45:"North East Scotland Orkney &amp; Shetland",42:"Mid Wales",43:"Norfolk",40:"London",41:"Manchester",1:"Beds Herts &amp; Bucks",3:"Berkshire",4:"Birmingham and Black Country",7:"Bristol",8:"Cambridgeshire",13:"Cumbria",12:"Coventry &amp; Warwickshire",30:"Highlands &amp; Islands",58:"Stoke &amp; Staffordshire",11:"Cornwall",39:"Liverpool",38:"Lincolnshire",59:"Suffolk",22:"Glasgow &amp; West of Scotland",17:"Devon",16:"Derby",19:"Edinburgh Fife &amp; East of Scotland",18:"Dorset",31:"Humberside",23:"Gloucestershire",51:"Shropshire",50:"Oxford",53:"South East Wales",52:"Somerset",33:"Jersey",55:"South Scotland",37:"Leicestershire",32:"Isle of Man",57:"Sheffield &amp; South Yorkshire",65:"Wiltshire"},s={56:"southwestwales",42:"midwales",50:"oxford",60:"sussex",61:"taysideandcentralscotland",62:"tees",63:"tyne",49:"nottingham",66:"surrey",52:"somerset",53:"southeastwales",26:"guernsey",27:"hampshire",20:"essex",21:"northernireland",22:"glasgowandwestscotland",23:"gloucestershire",46:"northeastwales",47:"northwestwales",44:"northampton",45:"northeastscotlandnorthernisles",28:"herefordandworcester",43:"norfolk",40:"london",41:"manchester",1:"threecounties",3:"berkshire",4:"birmingham",7:"bristol",8:"cambridgeshire",39:"liverpool",38:"lincolnshire",58:"stoke",11:"cornwall",51:"shropshire",13:"cumbria",12:"coventry",59:"suffolk",48:"york",17:"devon",16:"derby",19:"edinburghandeastscotland",18:"dorset",31:"humberside",30:"highlandsandislands",37:"leicester",36:"leeds",35:"lancashire",34:"kent",33:"jersey",55:"southscotland",32:"isleofman",57:"sheffield",65:"wiltshire"},i={e:"england",n:"northernireland",s:"scotland",w:"wales"};return e}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/bbc_cookies",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.BBCCookies=t(),void 0)}(this,function(){function e(){this._isSupported="object"==typeof window.bbccookies,this._isSupported&&(this._policy=window.bbccookies.readPolicy())}return e.prototype.isSupported=function(){return this._isSupported},e.prototype.readPolicy=function(){return this._isSupported?this._policy:!1},e.prototype.isPersonalisationDisabled=function(){return this._isSupported?!1===this._policy.personalisation:!1},e}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/cookies",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.Cookies=t(),void 0)}(this,function(){function e(){}return e.prototype.isSupported=function(){var e="locservices_ui_test_cookie",t="test",o=!1;return this.set(e,t),this.get(e)===t&&(o=!0),this.unset(e),o},e.prototype.hasItem=function(e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},e.prototype.get=function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},e.prototype.set=function(e,t,o,n,r){var s;return!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e)?!1:(o&&"string"!=typeof o&&(o=void 0),s=encodeURIComponent(e)+"="+encodeURIComponent(t)+(o?"; expires="+o:"")+(r?"; domain="+r:"")+(n?"; path="+n:""),document.cookie=s,s)},e.prototype.unset=function(e,t,o){var n;return e&&this.hasItem(e)?(n=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(o?"; domain="+o:"")+(t?"; path="+t:""),document.cookie=n,n):!1},e}),define("locservices/ui/component/component",["jquery"],function(e){"use strict";function t(){}return t.prototype.setComponentOptions=function(e){if(e=e||{},void 0===e.translations)throw new Error("Component requires a translations parameter.");if(this.translations=e.translations,void 0===e.container)throw new Error("Component requires container parameter.");this.container=e.container,this.componentId=e.componentId||"component",this.eventNamespaceBase="locservices:ui",e.eventNamespace&&(this.eventNamespaceBase=e.eventNamespace),this.eventNamespace=this.eventNamespaceBase+":component:"+this.componentId},t.prototype.emit=function(t,o){o=o||[];var n=this.eventNamespace;"error"===t&&(n=this.eventNamespaceBase),e.emit(n+":"+t,o)},t.prototype.on=function(t,o){var n=this.eventNamespace;"error"===t&&(n=this.eventNamespaceBase),e.on(n+":"+t,o)},t}),define("locservices/ui/component/search",["jquery","locservices/ui/component/component"],function(e,t){"use strict";function o(t){var o,n=this;if(t=t||{},t.componentId="search",void 0===t.api)throw new Error("Search requires api parameter");n.api=t.api,n.setComponentOptions(t),n.isSearching=!1,n.hasAValidSearchTerm=!1,n.locationName=t.locationName,o="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,c(n.translations,n.container,o),n.input=n.container.find("input[type=text]").on("keyup",function(){n.checkInput()}),"string"==typeof n.locationName&&n.input.val(n.locationName),o&&(this.hasClearControl=!0,n.container.find(".ls-ui-input-clear").on("click",function(){n.clear()})),n.form=n.container.find("form"),n.form.on("submit",function(e){e.preventDefault(),n.search(n.input.val())}),n.input.on("focus",function(){n.input.val()===n.locationName&&n.input.val(""),n.emit("focus")}),n.container.find("input[type=submit]").on("click",function(){n.form.trigger("submit")}),e.on(n.eventNamespaceBase+":controller:inactive",function(){void 0!==n.locationName&&n.input.val(n.locationName)})}var n=function(){return e("<div />").addClass("ls-ui-container")},r=function(){return e("<form />").attr("method","post").attr("action","#").addClass("ls-ui-form").addClass("ls-ui-comp-search")},s=function(t){return e("<input />").attr("type","text").attr("class","ls-ui-input").attr("placeholder",t.get("search.placeholder"))},i=function(t){return e("<button />").attr("class","ls-ui-input-clear").text(t.get("search.clear"))},a=function(t){return e("<input />").attr("type","submit").attr("class","ls-ui-submit").attr("value",t.get("search.submit")).attr("title",t.get("search.submit.title"))};o.prototype=new t,o.prototype.constructor=o,o.prototype.clear=function(){this.input.val(""),this.hasAValidSearchTerm=!1,this.form.removeClass("ls-ui-comp-search-with-term"),this.hasClearControl&&this.form.removeClass("ls-ui-comp-search-with-clear"),this.emit("clear")},o.prototype.checkInput=function(){var e=this.input.val();0<e.length?!1===this.hasAValidSearchTerm&&(this.hasAValidSearchTerm=!0,this.form.addClass("ls-ui-comp-search-with-term"),this.hasClearControl&&this.form.addClass("ls-ui-comp-search-with-clear")):this.hasAValidSearchTerm&&this.clear()},o.prototype.search=function(e){var t=this;e=(e||"").replace(/^\s+|\s+$/g,""),e&&!0!==t.isSearching&&(t.emit("start",[e]),t.isSearching=!0,t.api.search(e,{success:function(e){t.emit("end"),t.isSearching=!1,t.emit("results",[e.results,e.metadata])},error:function(){t.emit("end"),t.isSearching=!1,t.emit("error",[{code:"search.error.search",message:"There was an API error searching for "+e}])}}))};var c=function(e,t,o){var c;c=r().append(n().append(s(e))).append(a(e)),o&&c.append(i(e)),t.append(c)};return o}),define("locservices/ui/component/message",["jquery","locservices/ui/component/component"],function(e,t){"use strict";function o(t){var o,r=this;t=t||{},t.componentId="message",r.setComponentOptions(t),n(r.container),r.element=r.container.find("p"),r.on("error",function(e){return"object"==typeof e?(o=r.translations.get(e.code),void(o&&r.set(o))):void r.set(e)}),e.on(r.eventNamespaceBase+":component:search:clear",function(){r.clear()}),e.on(r.eventNamespaceBase+":component:search:start",function(){r.clear()}),e.on(r.eventNamespaceBase+":component:geolocation:click",function(){r.clear()}),e.on(r.eventNamespaceBase+":component:search_results:results",function(e){if(0===e.totalResults)return void r.set(r.translations.get("message.no_results",{searchTerm:e.searchTerm}));var t=e.offset+10;t=t>e.totalResults?e.totalResults:t,r.set(r.translations.get("message.total_results",{current:t,total:e.totalResults}))})}o.prototype=new t,o.prototype.constructor=o,o.prototype.clear=function(){this.element.removeClass("ls-ui-active"),this.element.text("")},o.prototype.set=function(e){return"string"==typeof e?(this.element.addClass("ls-ui-active"),this.element.text(e),!0):!1};var n=function(t){var o=e("<div / >").addClass("ls-ui-comp-message");t.append(o.append(e("<p />")))};return o}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/geolocation",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.geolocation=t(),void 0)}(this,function(){function e(){return"geolocation"in navigator}function t(t,o,n){return n=n||{timeout:1e4,maximumAge:60,enableHighAccuracy:!0},e()?(navigator.geolocation.getCurrentPosition(t,o,n),!0):!1}return{isSupported:e(),getCurrentPosition:t}}),define("locservices/ui/component/geolocation",["jquery","locservices/ui/component/component","locservices/core/geolocation"],function(e,t,o){function n(e,t){return function(){return e.apply(t,arguments)}}function r(e){if(this.isSupported=o.isSupported,this.isSupported!==!1){if(e=e||{},e.componentId="geolocation","object"!=typeof e.api)throw new Error("Gelocation requires an API option.");this.api=e.api;var t=this;this.setComponentOptions(e),this.emit("available");var n=this.translations.get("geolocation.button.label");this.container.append(s.replace("{text}",n)),this._button=this.container.find("button.ls-ui-comp-geolocation"),this._button.on("click",function(e){e.preventDefault(),t.emit("click"),t.reverseGeocode()})}}var s='<button type="button" class="ls-ui-comp ls-ui-comp-geolocation">';return s+='<span class="ls-ui-comp-geolocation-label">{text}</span>',s+='<span class="ls-ui-comp-geolocation-icon"></span></button>',r.prototype=new t,r.prototype.constructor=r,r.prototype.reverseGeocode=function(){function e(e){var t=e.coords.longitude,o=e.coords.latitude;r.api.reverseGeocode(o,t,{success:function(e){var t=e.results[0];t.isWithinContext?(r._button.removeAttr("disabled").removeClass("ls-ui-comp-geolocation-disabled"),r.emit("location",[t])):r.emit("error",[{code:"geolocation.error.outsideContext",message:"Your location is not currently supported by this application"}])},error:function(){r.emit("error",[{code:"geolocation.error.http",message:"We were unable to make a location api request"}])}})}function t(e){var t="geolocation.error.browser",o="An error occurred obtaining the browsers position. Error code "+e.code;1===e.code&&(t+=".permission"),this.emit("error",[{code:t,message:o}])}var r=this;this._button.attr("disabled","disabled").addClass("ls-ui-comp-geolocation-disabled"),this.emit("start"),o.getCurrentPosition(n(e,this),n(t,this))},r}),define("locservices/ui/component/auto_complete",["jquery","locservices/ui/component/component"],function(e,t){function o(t){var o=this;if(t=t||{},t.componentId="auto_complete","object"!=typeof t.api)throw new Error("AutoComplete requires an api option");if(!(t.element instanceof e))throw new Error("AutoComplete requires an element option");o._waitingForResults=!1,o._searchSubmitted=!1,o._timeoutId=void 0,o._highlightedSearchResultIndex=null,o._api=t.api,o.input=t.element.attr("autocomplete","off"),o.searchResultsData=[],o.currentSearchTerm="",o.setComponentOptions(t),o.searchResults=e("<ul />").addClass("ls-ui-comp-auto_complete"),o.container.append(o.searchResults),o.on("results",function(e){o.render(e)}),e.on(o.eventNamespaceBase+":component:search:start",function(){o._searchSubmitted=!0,o.requestedSearchTerm=void 0,o.currentSearchTerm=o.prepareSearchTerm(o.input.val())}),e.on(o.eventNamespaceBase+":component:search:clear",function(){o.requestedSearchTerm=void 0,o.currentSearchTerm="",o.clear()}),o.input.on("keyup",function(e){var t=e.keyCode;t!==n.escape&&t!==n.enter&&t!==n.upArrow&&t!==n.downArrow&&o.autoComplete()}),o.searchResults.on("mouseover","li",function(){o.highlightSearchResultByIndex(e(this).index(),!1)}),o.searchResults.on("mouseout","li",function(){e(this).removeClass("ls-ui-active")}),o.searchResults.on("mousedown","li",function(){var t=o.searchResultsData[e(this).index()];o.emit("location",[t,o.currentSearchTerm]),o.clear()}),e(o.container).on("keydown",function(e){switch(e.keyCode){case n.escape:o.escapeKeyHandler();break;case n.enter:o.enterKeyHandler(e);break;case n.upArrow:e.preventDefault(),o.highlightPrevSearchResult();break;case n.downArrow:o.highlightNextSearchResult()}})}var n={enter:13,escape:27,upArrow:38,downArrow:40},r=2,s=500;return o.prototype=new t,o.prototype.constructor=o,o.prototype.autoComplete=function(){var e=this,t=this.prepareSearchTerm(this.input.val()),o=t.length<r;return this._waitingForResults||o||t===e.currentSearchTerm?void(o&&e.currentSearchTerm&&(e.clear(!0),e.currentSearchTerm="")):(e.currentSearchTerm=t,clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){!0!==e._searchSubmitted&&t!==e.requestedSearchTerm&&(e._waitingForResults=!0,e.requestedSearchTerm=t,e._api.autoComplete(t,{success:function(t){e._waitingForResults=!1,!1===e._searchSubmitted&&e.currentSearchTerm===e.requestedSearchTerm&&e.emit("results",[t.results,t.metadata]),e.requestedSearchTerm=void 0},error:function(){e._waitingForResults=!1,!1===e._searchSubmitted&&e.currentSearchTerm===e.requestedSearchTerm&&e.emit("error",[{code:"auto_complete.error.search",message:"There was a problem searching for the search term"}]),e.requestedSearchTerm=void 0}}))},s),void(this._searchSubmitted=!1))},o.prototype.clear=function(e){this.searchResultsData=[],this._highlightedSearchResultIndex=null,this.searchResults.empty(),e&&this.emit("clear")},o.prototype.render=function(e){if(0===e.length)return void this.clear();var t,o,n="",r="",s={};for(t=this,t.searchResultsData=e,t.emit("render"),o=0;o<e.length;o++)s=e[o],r=s.name,s.container&&(r+=", "+s.container),r=t.highlightTerm(r,this.currentSearchTerm),n+='<li><a href="#" data-index="'+o+'">'+r+"</a></li>";this.searchResults.empty(),this.searchResults.append(n),this.searchResults.find("li a").on("click",function(e){e.preventDefault(),e.stopPropagation()})},o.prototype.escapeKeyHandler=function(){this.searchResultsData&&(null!==this._highlightedSearchResultIndex&&this.input.val(this.currentSearchTerm),this.clear(!0))},o.prototype.enterKeyHandler=function(e){if(null!==this._highlightedSearchResultIndex){e.preventDefault();var t=this.searchResultsData[this._highlightedSearchResultIndex];this.emit("location",[t,this.currentSearchTerm])}this.clear()},o.prototype.prepareSearchTerm=function(e){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return"";return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},o.prototype.highlightTerm=function(e,t){var o=new RegExp(t,"i"),n=e.search(o);return n>=0?e.substr(0,n)+"<strong>"+e.substr(n,n+t.length)+"</strong>"+e.substr(n+t.length):e},o.prototype.highlightNextSearchResult=function(){if(0!==this.searchResultsData.length){var e=this._highlightedSearchResultIndex;if(null===e)e=0;else if(e++,this.searchResultsData.length<=e)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(e,!0)}},o.prototype.highlightPrevSearchResult=function(){if(0!==this.searchResultsData.length){var e=this._highlightedSearchResultIndex;if(null===e)e=this.searchResultsData.length-1;else if(e--,0>e)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(e,!0)}},o.prototype.highlightSearchResultByIndex=function(t,o){var n=this.searchResultsData[t],r=n.name;n.container&&(r+=", "+n.container),this.removeSearchResultHighlight(),this._highlightedSearchResultIndex=t,e(this.searchResults.find("li")[t]).addClass("ls-ui-active"),o&&this.input.val(r)},o.prototype.removeSearchResultHighlight=function(e){this._highlightedSearchResultIndex=null,this.searchResults.find("li.ls-ui-active").removeClass("ls-ui-active"),e&&this.input.val(this.currentSearchTerm)},o}),define("locservices/ui/component/search_results",["jquery","locservices/ui/component/component"],function(e,t){"use strict";function o(t){var o=this;if(t=t||{},t.componentId="search_results",void 0===t.api)throw new Error("SearchResults requires api parameter");o.api=t.api,o.setComponentOptions(t),e.on(this.eventNamespaceBase+":component:search:results",function(e,t){if(1===t.totalResults){var n=e[0];return void o.emit("location",[n])}o.render(e,t)}),e.on(o.eventNamespaceBase+":component:search:clear",function(){o.clear()}),e.on(o.eventNamespaceBase+":component:search:start",function(){o.clear()}),o._data={},o.setup()}return o.prototype=new t,o.prototype.constructor=o,o.prototype.setup=function(){this.element=e("<div />").addClass("ls-ui-comp-search_results"),this.list=e("<ul />"),this.moreResults=e("<button />").addClass("ls-ui-comp-search_results-more").text(this.translations.get("search_results.more")),this.element.append(this.list).append(this.moreResults),this.container.append(this.element);var t=this;this.list.on("click",function(o){var n,r,s;return o.preventDefault(),r=e(o.target).data("id"),s=e(o.target).data("offset"),n=t._data[r],t.clear(),t.emit("location",[n,s]),!1});var o=!1;this.moreResults.on("click",function(e){return e.preventDefault(),o!==!0?(o=!0,t.api.search(t.searchTerm,{start:t.offset+10,success:function(e){t.render(e.results,e.metadata),o=!1}}),!1):void 0})},o.prototype.render=function(e,t){var o,n,r,s,i,a="";if(r=e.length,o=this,this.offset=t.start||0,this.searchTerm=t.search,0===r)this.element.removeClass("ls-ui-comp-search_results-with_results");else{for(this.element.addClass("ls-ui-comp-search_results-with_results"),n=0;r>n;n++)s=e[n],this._data[s.id]=s,i=s.name,s.container&&(i+=", "+s.container),a+='<li><a href="" data-id="'+s.id+'" data-offset="'+this.offset+'">'+i+"</a></li>";0===this.offset?this.list.html(a):this.list.append(a),t.totalResults>10&&this.offset+10<t.totalResults?this.moreResults.addClass("ls-ui-comp-search_results-active"):this.moreResults.removeClass("ls-ui-comp-search_results-active"),this.list.find("li:nth-child("+(o.offset+1)+") a").focus()}this.emit("results",{searchTerm:this.searchTerm,offset:this.offset,totalResults:t.totalResults})},o.prototype.clear=function(){this.moreResults.removeClass("ls-ui-comp-search_results-active"),this.element.removeClass("ls-ui-comp-search_results-with_results"),this.list.empty(),this._data={}},o}),define("locservices/ui/component/dialog",["jquery","locservices/ui/component/component"],function(e,t){"use strict";function o(e){var t=this;e=e||{},this.setComponentOptions(e),this.confirmLabel=e.confirmLabel||"Confirm",this.cancelLabel=e.cancelLabel||"Cancel";var o=function(e){t.remove(),"function"==typeof e&&e()};this.container.append(n.dialog(e.message,this.confirmLabel,this.cancelLabel,this.eventNamespaceBase)),this.container.find(".ls-ui-comp-dialog-confirm button").on("click",function(){o(e.confirm)}).focus();var r=this.container.get(0);"function"==typeof r.scrollIntoViewIfNeeded&&r.scrollIntoViewIfNeeded(),this.container.find(".ls-ui-comp-dialog-cancel button").on("click",function(){o(e.cancel)})}var n={dialog:function(t,o,r,s){var i=s+"-dialog-label",a=e("<div/>").attr("role","dialog").attr("aria-labelledby",i).addClass("ls-ui-comp-dialog"),c=e("<p/>").attr("id",i).html(t),l=e("<div/>").addClass("ls-ui-comp-dialog-buttons");return l.append(n.button(o,"ls-ui-comp-dialog-confirm")),l.append(n.button(r,"ls-ui-comp-dialog-cancel")),a.append(c).append(l),a},button:function(t,o){var n=e("<span/>").append(e("<button/>"));return o&&n.addClass(o),n.find("button").text(t),n}};return o.prototype=new t,o.prototype.constructor=o,o.prototype.remove=function(){this.container.find(".ls-ui-comp-dialog").remove()},o}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/recent_locations",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.RecentLocations=t(),void 0)}(this,function(){function e(e){return e=e||{},e.hasOwnProperty("placeType")&&("postcode"===e.placeType||"district"===e.placeType||e.hasOwnProperty("container"))?e.id&&"string"==typeof e.id&&e.name:!1}function t(){this._prefix="locservices-recent-locations"}function o(){this.isSupported()&&(this._storageAdapter=new t)}var n=function(){var e="bbc-locservices-core-js";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}(),r=n?localStorage:{},s="object"==typeof window.JSON&&n;return t.prototype.get=function(){var e=[],t=r[this._prefix];if(!t)return e;try{e=JSON.parse(r[this._prefix])}catch(o){}return e},t.prototype.set=function(e){return"[object Array]"!==Object.prototype.toString.call(e)?!1:void(r[this._prefix]=JSON.stringify(e))},o.prototype.isSupported=function(){return s},o.prototype.all=function(){return void 0===this._storageAdapter?[]:this._storageAdapter.get()},o.prototype.add=function(t){if(void 0===this._storageAdapter||!e(t))return!1;if(this.contains(t.id))return this.remove(t.id),this.add(t),!0;var o=this._storageAdapter.get();return o.unshift(t),4<o.length&&(o=o.slice(0,4)),this._storageAdapter.set(o),!0},o.prototype.remove=function(e){var t,o,n=[];if(void 0===this._storageAdapter)return!1;t=this._storageAdapter.get();for(o in t)t.hasOwnProperty(o)&&t[o].id.toString()!==e.toString()&&n.push(t[o]);this._storageAdapter.set(n)},o.prototype.clear=function(){return void 0===this._storageAdapter?!1:(this._storageAdapter.set([]),!0)},o.prototype.contains=function(e){var t,o,n=!1;if(void 0===this._storageAdapter)return!1;t=this._storageAdapter.get();for(o in t)t.hasOwnProperty(o)&&t[o].id===e&&(n=!0);return n},o}),function(e,t){return"function"==typeof define&&define.amd?define("locservices/core/filter",t):("undefined"==typeof e.locservices&&(e.locservices={}),"undefined"==typeof e.locservices.core&&(e.locservices.core={}),e.locservices.core.filter=t(),void 0)}(this,function(){var e={placeType:"settlement, airport",country:"GB, GG, IM, JE"},t={placeType:"settlement, airport, country"},o=function(e,t){return"undefined"==typeof t||"undefined"==typeof e?e:"string"==typeof t.filter?n(e,t):(e=r(e,"placeType",t.placeType),r(e,"country",t.country))},n=function(n,r){if("domestic"!==r.filter&&"international"!==r.filter)return r.filter=void 0,o(n,r);var s="domestic"===r.filter?e:t;return"undefined"!=typeof r.placeType&&(s.placeType=r.placeType),"undefined"!=typeof r.country&&(s.country=r.country),o(n,s)},r=function(e,t,o){var n=(o||"").replace(/^\s+|\s+$/g,"");if(""===n)return e;for(var r=[],s=e.length,i=0;s>i;i++){var a=e[i];
a.hasOwnProperty(t)&&-1!==n.indexOf(a[t])&&r.push(a)}return r};return o}),define("locservices/ui/component/user_locations",["jquery","locservices/ui/component/component","locservices/ui/component/dialog","locservices/core/bbc_cookies","locservices/core/recent_locations","locservices/core/preferred_location","locservices/core/filter"],function(e,t,o,n,r,s,i){"use strict";function a(t){var o,i,a,l=this;if(t=t||{},t.componentId="user_locations",void 0===t.api)throw new Error("User locations requires api parameter");if(o=t.api,this.setComponentOptions(t),i=new n,!i.isPersonalisationDisabled()){this._locations=[],a=o.getDefaultQueryParameters(),this._filter={filter:a.filter,country:a.countries,placeType:a["place-types"]},this.preferredLocation=new s(o),this.recentLocations=new r,this.isPreferredLocationEnabled="undefined"==typeof t.isPreferredLocationEnabled?!0:t.isPreferredLocationEnabled,this.element=c.element(this.isPreferredLocationEnabled),this.container.append(this.element),this.render(),this.element.on("click","button,a",function(t){var o,n,r,s;t.preventDefault(),t.stopPropagation(),o=e(t.currentTarget),l._isDisplayingDialog||(n=String(o.data("id")),s=l._locations[n],s&&(r=o.data("action"),"location"===r?l.selectLocationById(n):"prefer"===r?l.displayDialog(o.parent("li"),l.translations.get("user_locations.dialog.prefer",{name:s.name}),function(){l.setPreferredLocationById(n)}):"remove"===r&&(s.isPreferred?l.displayDialog(o.parent("li"),l.translations.get("user_locations.dialog.remove_preferred",{name:s.name}),function(){l.removeLocationById(n)}):l.removeLocationById(n))))});var u=function(e){l.recentLocations.isSupported()&&l.recentLocations.add(e)&&(l.emit("location_add",[e]),l.render())};e.on(this.eventNamespaceBase+":controller:inactive",function(){l.removeDialog()}),e.on(this.eventNamespaceBase+":component:search:results",function(){l.removeDialog()}),e.on(this.eventNamespaceBase+":component:auto_complete:render",function(){l.removeDialog()}),e.on(this.eventNamespaceBase+":component:search_results:location",function(e){u(e)}),e.on(this.eventNamespaceBase+":component:geolocation:location",function(e){u(e)}),e.on(this.eventNamespaceBase+":component:auto_complete:location",function(e){u(e)})}}var c={element:function(t){var o=e("<div />").addClass("ls-ui-comp-user_locations");return t&&o.addClass("ls-ui-comp-user_locations-with_preferable"),o},preferredLocationList:e("<ul/>").addClass("ls-ui-comp-user_locations-preferred"),preferredLocationHeading:function(t){return e("<p />").addClass("ls-ui-comp-user_locations-heading").text(t.get("user_locations.heading.preferred"))},recentLocationsList:e("<ul/>").addClass("ls-ui-comp-user_locations-recent"),recentLocationsHeading:function(t,o,n){var r="user_locations.heading.your_locations";return n&&(r="user_locations.heading.other_locations"),e("<p />").addClass("ls-ui-comp-user_locations-heading").addClass("ls-ui-comp-user_locations-recent-heading").text(t.get(r)+" ("+o+")")},location:function(t,o){var n=o.id,r=e("<a/>").addClass("ls-ui-comp-user_locations-name").attr("href","#"+n).attr("data-id",n).attr("data-action","location").html(e("<strong/>").text(o.name));o.container&&r.append(", "+o.container);var s=o.isPreferred?"user_locations.action.label.remove":"user_locations.action.label.prefer",i=e("<button/>").addClass("ls-ui-comp-user_locations-action").attr("href","#"+n).attr("data-id",n).attr("data-action",o.isPreferred?"none":"prefer").attr("aria-label",t.get(s,{name:o.name})).html(e("<span/>").text(t.get("user_locations.action.recent")));o.isPreferred&&i.attr("disabled","disabled");var a=o.isPreferred?"user_locations.action.label.remove":"user_locations.action.label.delete",c=e("<button/>").addClass("ls-ui-comp-user_locations-remove").attr("href","#"+n).attr("data-id",n).attr("data-action","remove").attr("aria-label",t.get(a,{name:o.name})).html(e("<span/>").text(t.get("user_locations.action.remove"))),l=e("<li />");return l.addClass("ls-ui-comp-user_locations-location"),o.isPreferred&&l.addClass("ls-ui-comp-user_locations-location-preferred"),o.isPreferable&&(l.addClass("ls-ui-comp-user_locations-location-preferable"),l.append(i)),l.append(r).append(c),l},message:function(t,o,n){var r=t.get("user_locations.message.preferred");return o&&(r+=" "+t.get("user_locations.message.change_preferred")),e("<p/>").addClass("ls-ui-comp-user_locations-message").attr("id",n+"ls-ui-comp-user_locations-message").text(r)}};return a.prototype=new t,a.prototype.constructor=a,a.prototype.displayDialog=function(e,t,n){var r=this;return this._isDisplayingDialog?!1:(this._isDisplayingDialog=!0,this._dialogElement=e,e.addClass("ls-ui-comp-user_locations-location-with-dialog"),this._dialog=new o({container:e,translations:this.translations,message:t,confirmLabel:this.translations.get("user_locations.dialog.confirm"),cancelLabel:this.translations.get("user_locations.dialog.cancel"),confirm:function(){r.removeDialog(),"function"==typeof n&&n()},cancel:function(){r.removeDialog()}}),!0)},a.prototype.removeDialog=function(){this._isDisplayingDialog&&this._dialog&&this._dialogElement&&(this._dialog.remove(),this._dialogElement.removeClass("ls-ui-comp-user_locations-location-with-dialog")),this._isDisplayingDialog=!1,this._dialog=void 0,this._dialogElement=void 0},a.prototype.selectLocationById=function(e){var t;t=this._locations[e],t&&this.emit("location",[t])},a.prototype.setPreferredLocationById=function(e){var t,o,n,r;t=this,r=this.recentLocations.isSupported(),o=this._locations[e],o&&this.preferredLocation.isValidLocation(o)&&(r&&this.recentLocations.remove(e),this.element.find(".ls-ui-comp-user_locations-location-preferred").removeClass("ls-ui-comp-user_locations-location-preferred"),this.element.find('a[data-id="'+e+'"]').parent().addClass("ls-ui-comp-user_locations-location-preferred"),this.preferredLocation.isSet()&&(n=this.preferredLocation.get(),r&&this.recentLocations.add(n)),this.preferredLocation.set(o.id,{success:function(){t.render(),t.emit("location_prefer",[o])},error:function(){t.emit("error",[{code:"user_locations.error.preferred_location",message:"There was an error setting preferred location to "+o.id}])}}))},a.prototype.removeLocationById=function(e){var t;t=this._locations[e],t&&(t.isPreferred&&this.preferredLocation.unset(),this.recentLocations.isSupported()&&this.recentLocations.remove(e),this.render(),this.emit("location_remove",[t]))},a.prototype.render=function(){var e,t,o,n,r,s,i,a;if(o=this.preferredLocation.isSet(),n=this.getRecentLocations(),i=n.length,s=i>0,e=o||s,this._locations={},this.element.empty(),c.preferredLocationList.empty(),c.recentLocationsList.empty(),this.isPreferredLocationEnabled&&(e&&this.element.append(c.preferredLocationHeading(this.translations)),o?(t=this.preferredLocation.get(),this._locations[t.id]=t,t.isPreferred=!0,t.isPreferable=!0,c.preferredLocationList.append(c.location(this.translations,t))):c.preferredLocationList.addClass("ls-ui-comp-user_locations-preferred-no-location"),e&&this.element.append(c.preferredLocationList)),s){for(this.element.append(c.recentLocationsHeading(this.translations,i,this.isPreferredLocationEnabled)),a=0;i>a;a++)r=n[a],this._locations[r.id]=r,c.recentLocationsList.append(c.location(this.translations,r));this.element.append(c.recentLocationsList),this.element.attr("role","navigation")}e&&this.isPreferredLocationEnabled&&(this.element.append(c.message(this.translations,s,this.eventNamespaceBase)),this.element.attr("role","navigation"),this.element.attr("aria-describedby",this.eventNamespaceBase+"ls-ui-comp-user_locations-message"))},a.prototype.getRecentLocations=function(){var e,t,o,n,r,s=[];if(this.preferredLocation.isSet()&&(e=this.preferredLocation.get()),this.recentLocations.isSupported()&&(t=i(this.recentLocations.all(),{filter:this._filter.filter,placeType:this._filter.placeType,country:this._filter.country}),o=t.length,o>0))for(o>4&&(t=t.slice(0,4),o=4),r=0;o>r;r++)n=t[r],this.isPreferredLocationEnabled&&e&&e.id===n.id||(n.isPreferable=this.isPreferredLocationEnabled&&this.preferredLocation.isValidLocation(n),s.push(n));return s},a}),define("locservices/ui/component/close_button",["jquery","locservices/ui/component/component"],function(e,t){"use strict";function o(e){var t=this;e=e||{},e.componentId="close_button",t.setComponentOptions(e),t.button=n(t.translations),t.container.append(t.button),t.button.on("click",function(e){e.preventDefault(),t.emit("clicked")})}var n=function(t){return e("<button />").addClass("ls-ui-comp-close_button").text(t.get("close_button.label"))};return o.prototype=new t,o.prototype.constructor=o,o}),define("locservices/ui/utils/stats",["jquery","locservices/core/geolocation","locservices/core/recent_locations","locservices/core/cookies","locservices/core/bbc_cookies","locservices/core/preferred_location"],function(e,t,o,n,r,s){"use strict";function i(e,t,o){e.userActionEvent(t,"locservicesui",o||{})}function a(e){var t={};return"object"!=typeof e?t:(t.locationId=e.id,t.locationPlaceType=e.placeType,t.locationCountry=e.country,t.locationName=e.name,e.container&&(t.locationName+=", "+e.container),m&&(t.addedToRecentLocations=!0),t)}function c(e,t){if(t=t||{},t.namespace=t.namespace||"locservices:ui",l||(i(e,"locservices_user",g),l=!0),!e||"object"!=typeof e)throw new Error("The stats module requires an instance of an EchoClient");this._echoClient=e,this._registeredNamespaces={},this.registerNamespace(t.namespace)}var l=!1,u=new s,p=u.isSet(),d=u.get(),h=new o,m=h.isSupported(),f=m?h.all():[],v=function(){var e="bbc-locservices-ui-js";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}(),g={capability_geolocation:t.isSupported,capability_recent_locations:h.isSupported(),capability_local_storage:v,capability_cookies_enabled:(new n).isSupported(),capability_bbccookies_preference_enabled:(new r).isPersonalisationDisabled(),has_locserv_cookie:p,has_recent_locations:m&&f.length>0,recent_locations_total:m?f.length:0,locserv_nation:p?d.nation:"",locserv_news_region:p&&d.news?d.news.tld:""};return c.prototype.registerNamespace=function(t){var o=this._echoClient;return this._registeredNamespaces[t]===!0?!1:(e.on(t+":component:geolocation:location",function(e){i(o,"geolocation_location",a(e))}),e.on(t+":error",function(e){"geolocation.error.browser.permission"===e.code&&i(o,"geolocation_denied")}),e.on(t+":component:geolocation:click",function(){i(o,"geolocation_click")}),e.on(t+":component:auto_complete:location",function(e,t){var n=a(e);n.searchTerm=t,n.searchTermLength=t.length,i(o,"auto_complete_location",n)}),e.on(t+":component:user_locations:location",function(e){var t="user_locations_location_select";e.isPreferred===!0&&(t="user_locations_location_main_select"),i(o,t,a(e))}),e.on(t+":component:user_locations:location_prefer",function(e){var t=a(e);i(o,"user_locations_location_prefer",t)}),e.on(t+":component:user_locations:location_remove",function(e){i(o,"user_locations_location_remove",a(e))}),e.on(t+":component:search_results:results",function(e){0===e.totalResults&&i(o,"search_no_results")}),e.on(t+":component:search_results:location",function(e,t){var n=a(e);n.offset=t,i(o,"search_results_location",n)}),this._registeredNamespaces[t]=!0,!0)},c}),define("js/controller/primary",["jquery","locservices/core/api","locservices/core/preferred_location","locservices/core/bbc_cookies","locservices/core/cookies","locservices/ui/component/search","locservices/ui/component/message","locservices/ui/component/geolocation","locservices/ui/component/auto_complete","locservices/ui/component/search_results","locservices/ui/component/user_locations","locservices/ui/component/close_button","locservices/ui/component/dialog","locservices/ui/utils/stats"],function(e,t,o,n,r,s,i,a,c,l,u,p,d,h){"use strict";function m(d){g(d),this.namespace=d.namespace||"locservices:ui","object"==typeof d.echoClient&&(this._stats=new h(d.echoClient,{namespace:this.namespace}));var m=this,y=d.alwaysOpen||!1,_=d.isPreferredLocationEnabled,w=d.isGeolocationEnabled;w="undefined"==typeof w?!0:w;var b={onError:function(){m.results.clear(),m.autoComplete.clear(),m.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onInputInteractionEnd:function(){m.coldStartDialog&&(m.coldStartDialog.remove(),m.coldStartDialog=void 0)},onLocation:function(e){m.message.clear(),m.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden"),m.selectLocation(e)},onActive:function(){m.isActive||(m.isActive=!0,e.emit(m.namespace+":controller:active"),m.container.addClass("ls-ui-ctrl-active"))},onGeolocationAvailable:function(){e.emit(m.namespace+":controller:geolocation:available"),m.container.addClass("ls-ui-ctrl-geolocation")},onSearchResults:function(){m.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onAutoCompleteResults:function(){m.message.clear(),m.results.clear(),m.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onResultsClear:function(){m.message.clear(),m.results.clear(),m.coldStartDialog&&(m.coldStartDialog.remove(),m.coldStartDialog=void 0),m.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden")},onClose:function(){m.close()}};m.translations=d.translations,m.api=new t(d.api),m.container=d.container,m.preferredLocation=new o(m.api),m.bbcCookies=new n,m.cookies=new r,m.cookiesColdStartKey="locserv_uics",m.container.addClass("ls-ui-ctrl-primary").append(f.append(v)),m.isActive=void 0,e.on(m.namespace+":error",b.onError),e.on(m.namespace+":component:search:focus",b.onActive),e.on(m.namespace+":component:search:start",b.onActive),e.on(m.namespace+":component:geolocation:click",b.onActive),e.on(m.namespace+":component:search:clear",b.onInputInteractionEnd),e.on(m.namespace+":component:search:end",b.onInputInteractionEnd),e.on(m.namespace+":component:auto_complete:results",b.onInputInteractionEnd),e.on(m.namespace+":component:search:results",b.onSearchResults),e.on(m.namespace+":component:auto_complete:render",b.onAutoCompleteResults),e.on(m.namespace+":component:auto_complete:clear",b.onResultsClear),e.on(m.namespace+":component:search:clear",b.onResultsClear),e.on(m.namespace+":component:geolocation:start",b.onResultsClear),e.on(m.namespace+":component:geolocation:location",b.onLocation),e.on(m.namespace+":component:auto_complete:location",b.onLocation),e.on(m.namespace+":component:user_locations:location",b.onLocation),e.on(m.namespace+":component:search_results:location",b.onLocation),e.on(m.namespace+":component:geolocation:available",b.onGeolocationAvailable),e.on(m.namespace+":component:close_button:clicked",b.onClose),m.search=new s({api:this.api,translations:m.translations,eventNamespace:m.namespace,container:v,locationName:d.locationName}),m.autoComplete=new c({api:this.api,translations:m.translations,eventNamespace:m.namespace,element:m.search.input,container:f}),m.message=new i({translations:m.translations,eventNamespace:m.namespace,container:f}),m.results=new l({api:this.api,translations:m.translations,eventNamespace:m.namespace,container:f}),w&&(m.geolocation=new a({api:this.api,translations:m.translations,eventNamespace:m.namespace,container:f})),m.userLocations=new u({api:this.api,translations:m.translations,eventNamespace:m.namespace,container:f,isPreferredLocationEnabled:_}),y?(m.container.addClass("ls-ui-ctrl-open"),b.onActive()):m.closeButton=new p({translations:m.translations,eventNamespace:m.namespace,container:f})}var f=e("<div />").addClass("ls-ui-o"),v=e("<div />").addClass("ls-ui-ctrl-primary-search"),g=function(e){for(var t=["api","translations","container"],o=t.length,n=0;o>n;n++){var r=t[n];if(!e[r])throw new Error("Primary Controller requires an "+r+" option.")}};return m.prototype.close=function(){this.isActive&&(this.isActive=!1,this.search.clear(),e.emit(this.namespace+":controller:inactive"),this.container.removeClass("ls-ui-ctrl-active"),this.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden"))},m.prototype.selectLocation=function(t){var o=this,n=function(){e.emit(o.namespace+":controller:location",[t])},r=function(){o.preferredLocation.set(t.id,{success:function(){t.wasSetAsPreferredLocationDueToColdStart=!0,n()},error:function(){n()}})},s=function(){var e=new Date;e.setFullYear(e.getFullYear()+1),o.cookies.set(o.cookiesColdStartKey,"1",e.toUTCString(),"/",o.preferredLocation.getCookieDomain()),n()};this.preferredLocation.isValidLocation(t)&&this.shouldColdStartDialogBeDisplayed()?this.coldStartDialog=new d({container:f,translations:this.translations,message:o.translations.get("primary.cold_start",{name:t.name}),confirmLabel:o.translations.get("primary.cold_start.confirm"),cancelLabel:o.translations.get("primary.cold_start.cancel"),confirm:function(){o.coldStartDialog=void 0,r()},cancel:function(){o.coldStartDialog=void 0,s()}}):n()},m.prototype.shouldColdStartDialogBeDisplayed=function(){return!1===this.preferredLocation.isSet()&&!1===this.bbcCookies.isPersonalisationDisabled()&&this.cookies.isSupported()&&"1"!==this.cookies.get(this.cookiesColdStartKey)&&!0===this.userLocations.isPreferredLocationEnabled},m});