define(["jquery","locservices/core/geolocation","locservices/core/recent_locations","locservices/core/cookies","locservices/core/bbc_cookies","locservices/core/preferred_location"],function(a,b,c,d,e,f){"use strict";function g(a,b,c){a.userActionEvent(b,"locservicesui",c||{})}function h(a){var b={};return"object"!=typeof a?b:(b.locationId=a.id,b.locationPlaceType=a.placeType,b.locationCountry=a.country,b.locationName=a.name,a.container&&(b.locationName+=", "+a.container),o&&(b.addedToRecentLocations=!0),b)}function i(a,b){if(b=b||{},b.namespace=b.namespace||"locservices:ui",j||(g(a,"locservices_user",r),j=!0),!a||"object"!=typeof a)throw new Error("The stats module requires an instance of an EchoClient");this._echoClient=a,this._registeredNamespaces={},this.registerNamespace(b.namespace)}var j=!1,k=new f,l=k.isSet(),m=k.get(),n=new c,o=n.isSupported(),p=o?n.all():[],q=function(){var a="bbc-locservices-ui-js";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}}(),r={capability_geolocation:b.isSupported,capability_recent_locations:n.isSupported(),capability_local_storage:q,capability_cookies_enabled:(new d).isSupported(),capability_bbccookies_preference_enabled:(new e).isPersonalisationDisabled(),has_locserv_cookie:l,has_recent_locations:o&&p.length>0,recent_locations_total:o?p.length:0,locserv_nation:l?m.nation:"",locserv_news_region:l&&m.news?m.news.tld:""};return i.prototype.registerNamespace=function(b){var c=this._echoClient;return this._registeredNamespaces[b]===!0?!1:(a.on(b+":component:geolocation:location",function(a){g(c,"geolocation_location",h(a))}),a.on(b+":error",function(a){"geolocation.error.browser.permission"===a.code&&g(c,"geolocation_denied")}),a.on(b+":component:geolocation:click",function(){g(c,"geolocation_click")}),a.on(b+":component:auto_complete:location",function(a,b){var d=h(a);d.searchTerm=b,d.searchTermLength=b.length,g(c,"auto_complete_location",d)}),a.on(b+":component:user_locations:location",function(a){var b="user_locations_location_select";a.isPreferred===!0&&(b="user_locations_location_main_select"),g(c,b,h(a))}),a.on(b+":component:user_locations:location_prefer",function(a){var b=h(a);g(c,"user_locations_location_prefer",b)}),a.on(b+":component:user_locations:location_remove",function(a){g(c,"user_locations_location_remove",h(a))}),a.on(b+":component:search_results:results",function(a){0===a.totalResults&&g(c,"search_no_results")}),a.on(b+":component:search_results:location",function(a,b){var d=h(a);d.offset=b,g(c,"search_results_location",d)}),this._registeredNamespaces[b]=!0,!0)},i});