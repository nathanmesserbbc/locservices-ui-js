define(["jquery","locservices/ui/component/component"],function(a,b){function c(b){var c=this;if(b=b||{},b.componentId="auto_complete","object"!=typeof b.api)throw new Error("AutoComplete requires an api option");if(!b.element instanceof a)throw new Error("AutoComplete requires an element option");c._waitingForResults=!1,c._searchSubmitted=!1,c._timeoutId=void 0,c._highlightedSearchResultIndex=null,c._api=b.api,c.input=b.element.attr("autocomplete","off"),c.searchResultsData=[],c.currentSearchTerm="",c.setComponentOptions(b),c.searchResults=a("<ul />").addClass("ls-ui-comp-auto_complete"),c.container.append(c.searchResults),c.on("results",function(a){c.render(a)}),a.on(c.eventNamespaceBase+":component:search:start",function(){c._searchSubmitted=!0,c.requestedSearchTerm=void 0,c.currentSearchTerm=c.prepareSearchTerm(c.input.val())}),a.on(c.eventNamespaceBase+":component:search:clear",function(){c.requestedSearchTerm=void 0,c.currentSearchTerm="",c.clear()}),c.input.on("keyup",function(a){var b=a.keyCode;b!==d.escape&&b!==d.enter&&b!==d.upArrow&&b!==d.downArrow&&c.autoComplete()}),c.searchResults.on("mouseover","li",function(){c.highlightSearchResultByIndex(a(this).index(),!1)}),c.searchResults.on("mouseout","li",function(){a(this).removeClass("ls-ui-active")}),c.searchResults.on("mousedown","li",function(){var b=c.searchResultsData[a(this).index()];c.emit("location",[b,c.currentSearchTerm]),c.clear()}),a(c.container).on("keydown",function(a){switch(a.keyCode){case d.escape:c.escapeKeyHandler();break;case d.enter:c.enterKeyHandler(a);break;case d.upArrow:a.preventDefault(),c.highlightPrevSearchResult();break;case d.downArrow:c.highlightNextSearchResult()}})}var d={enter:13,escape:27,upArrow:38,downArrow:40},e=2,f=500;return c.prototype=new b,c.prototype.constructor=c,c.prototype.autoComplete=function(){var a=this,b=this.prepareSearchTerm(this.input.val()),c=b.length<e;return this._waitingForResults||c||b===a.currentSearchTerm?void(c&&a.currentSearchTerm&&(a.clear(!0),a.currentSearchTerm="")):(a.currentSearchTerm=b,clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){!0!==a._searchSubmitted&&b!==a.requestedSearchTerm&&(a._waitingForResults=!0,a.requestedSearchTerm=b,a._api.autoComplete(b,{success:function(b){a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm&&a.emit("results",[b.results,b.metadata]),a.requestedSearchTerm=void 0},error:function(){a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm&&a.emit("error",[{code:"auto_complete.error.search",message:"There was a problem searching for the search term"}]),a.requestedSearchTerm=void 0}}))},f),void(this._searchSubmitted=!1))},c.prototype.clear=function(a){this.searchResultsData=[],this._highlightedSearchResultIndex=null,this.searchResults.empty(),a&&this.emit("clear")},c.prototype.render=function(a){if(0===a.length)return void this.clear();var b,c,d="",e="",f={};for(b=this,b.searchResultsData=a,b.emit("render"),c=0;c<a.length;c++)f=a[c],e=f.name,f.container&&(e+=", "+f.container),e=b.highlightTerm(e,this.currentSearchTerm),d+='<li><a href="#" data-index="'+c+'">'+e+"</a></li>";this.searchResults.empty(),this.searchResults.append(d),this.searchResults.find("li a").on("click",function(a){a.preventDefault(),a.stopPropagation()})},c.prototype.escapeKeyHandler=function(){this.searchResultsData&&(null!==this._highlightedSearchResultIndex&&this.input.val(this.currentSearchTerm),this.clear(!0))},c.prototype.enterKeyHandler=function(a){if(null!==this._highlightedSearchResultIndex){a.preventDefault();var b=this.searchResultsData[this._highlightedSearchResultIndex];this.emit("location",[b,this.currentSearchTerm])}this.clear()},c.prototype.prepareSearchTerm=function(a){if("number"==typeof a)a=String(a);else if("string"!=typeof a)return"";return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},c.prototype.highlightTerm=function(a,b){var c=new RegExp(b,"i"),d=a.search(c);return d>=0?a.substr(0,d)+"<strong>"+a.substr(d,d+b.length)+"</strong>"+a.substr(d+b.length):a},c.prototype.highlightNextSearchResult=function(){if(0!==this.searchResultsData.length){var a=this._highlightedSearchResultIndex;if(null===a)a=0;else if(a++,this.searchResultsData.length<=a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)}},c.prototype.highlightPrevSearchResult=function(){if(0!==this.searchResultsData.length){var a=this._highlightedSearchResultIndex;if(null===a)a=this.searchResultsData.length-1;else if(a--,0>a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)}},c.prototype.highlightSearchResultByIndex=function(b,c){var d=this.searchResultsData[b],e=d.name;d.container&&(e+=", "+d.container),this.removeSearchResultHighlight(),this._highlightedSearchResultIndex=b,a(this.searchResults.find("li")[b]).addClass("ls-ui-active"),c&&this.input.val(e)},c.prototype.removeSearchResultHighlight=function(a){this._highlightedSearchResultIndex=null,this.searchResults.find("li.ls-ui-active").removeClass("ls-ui-active"),a&&this.input.val(this.currentSearchTerm)},c}),define(["jquery","locservices/ui/component/component"],function(a,b){function c(b){var c=this;if(b=b||{},b.componentId="auto_complete","object"!=typeof b.api)throw new Error("AutoComplete requires an api option");if(!b.element instanceof a)throw new Error("AutoComplete requires an element option");c._waitingForResults=!1,c._searchSubmitted=!1,c._timeoutId=void 0,c._highlightedSearchResultIndex=null,c._api=b.api,c.input=b.element.attr("autocomplete","off"),c.searchResultsData=[],c.currentSearchTerm="",c.setComponentOptions(b),c.searchResults=a("<ul />").addClass("ls-ui-comp-auto_complete"),c.container.append(c.searchResults),c.on("results",function(a){c.render(a)}),a.on(c.eventNamespaceBase+":component:search:start",function(){c._searchSubmitted=!0,c.requestedSearchTerm=void 0,c.currentSearchTerm=c.prepareSearchTerm(c.input.val())}),a.on(c.eventNamespaceBase+":component:search:clear",function(){c.requestedSearchTerm=void 0,c.currentSearchTerm="",c.clear()}),c.input.on("keyup",function(a){var b=a.keyCode;b!==d.escape&&b!==d.enter&&b!==d.upArrow&&b!==d.downArrow&&c.autoComplete()}),c.searchResults.on("mouseover","li",function(){c.highlightSearchResultByIndex(a(this).index(),!1)}),c.searchResults.on("mouseout","li",function(){a(this).removeClass("ls-ui-active")}),c.searchResults.on("mousedown","li",function(){var b=c.searchResultsData[a(this).index()];c.emit("location",[b,c.currentSearchTerm]),c.clear()}),a(document).on("keydown",function(a){switch(a.keyCode){case d.escape:c.escapeKeyHandler();break;case d.enter:c.enterKeyHandler(a);break;case d.upArrow:a.preventDefault(),c.highlightPrevSearchResult();break;case d.downArrow:c.highlightNextSearchResult()}})}var d={enter:13,escape:27,upArrow:38,downArrow:40},e=2,f=500;return c.prototype=new b,c.prototype.constructor=c,c.prototype.autoComplete=function(){var a=this,b=this.prepareSearchTerm(this.input.val()),c=b.length<e;return this._waitingForResults||c||b===a.currentSearchTerm?void(c&&a.currentSearchTerm&&(a.clear(!0),a.currentSearchTerm="")):(a.currentSearchTerm=b,clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){!0!==a._searchSubmitted&&b!==a.requestedSearchTerm&&(a._waitingForResults=!0,a.requestedSearchTerm=b,a._api.autoComplete(b,{success:function(b){a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm&&a.emit("results",[b.results,b.metadata]),a.requestedSearchTerm=void 0},error:function(){a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm&&a.emit("error",[{code:"auto_complete.error.search",message:"There was a problem searching for the search term"}]),a.requestedSearchTerm=void 0}}))},f),void(this._searchSubmitted=!1))},c.prototype.clear=function(a){this.searchResultsData=[],this._highlightedSearchResultIndex=null,this.searchResults.empty(),a&&this.emit("clear")},c.prototype.render=function(a){if(0===a.length)return void this.clear();var b,c,d="",e="",f={};for(b=this,b.searchResultsData=a,b.emit("render"),c=0;c<a.length;c++)f=a[c],e=f.name,f.container&&(e+=", "+f.container),e=b.highlightTerm(e,this.currentSearchTerm),d+='<li><a href="#" data-index="'+c+'">'+e+"</a></li>";this.searchResults.empty(),this.searchResults.append(d),this.searchResults.find("li a").on("click",function(a){a.preventDefault(),a.stopPropagation()})},c.prototype.escapeKeyHandler=function(){this.searchResultsData&&(null!==this._highlightedSearchResultIndex&&this.input.val(this.currentSearchTerm),this.clear(!0))},c.prototype.enterKeyHandler=function(a){if(null!==this._highlightedSearchResultIndex){a.preventDefault();var b=this.searchResultsData[this._highlightedSearchResultIndex];this.emit("location",[b,this.currentSearchTerm])}this.clear()},c.prototype.prepareSearchTerm=function(a){if("number"==typeof a)a=String(a);else if("string"!=typeof a)return"";return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},c.prototype.highlightTerm=function(a,b){var c=new RegExp(b,"i"),d=a.search(c);return d>=0?a.substr(0,d)+"<strong>"+a.substr(d,d+b.length)+"</strong>"+a.substr(d+b.length):a},c.prototype.highlightNextSearchResult=function(){if(0!==this.searchResultsData.length){var a=this._highlightedSearchResultIndex;if(null===a)a=0;else if(a++,this.searchResultsData.length<=a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)}},c.prototype.highlightPrevSearchResult=function(){if(0!==this.searchResultsData.length){var a=this._highlightedSearchResultIndex;if(null===a)a=this.searchResultsData.length-1;else if(a--,0>a)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,!0)}},c.prototype.highlightSearchResultByIndex=function(b,c){var d=this.searchResultsData[b],e=d.name;d.container&&(e+=", "+d.container),this.removeSearchResultHighlight(),this._highlightedSearchResultIndex=b,a(this.searchResults.find("li")[b]).addClass("ls-ui-active"),c&&this.input.val(e)},c.prototype.removeSearchResultHighlight=function(a){this._highlightedSearchResultIndex=null,this.searchResults.find("li.ls-ui-active").removeClass("ls-ui-active"),a&&this.input.val(this.currentSearchTerm)},c});