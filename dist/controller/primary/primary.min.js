define(["jquery","locservices/core/api","locservices/core/preferred_location","locservices/core/bbc_cookies","locservices/core/cookies","locservices/ui/component/search","locservices/ui/component/message","locservices/ui/component/geolocation","locservices/ui/component/auto_complete","locservices/ui/component/search_results","locservices/ui/component/user_locations","locservices/ui/component/close_button","locservices/ui/component/dialog","locservices/ui/utils/stats"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(m){r(m),this.namespace=m.namespace||"locservices:ui","object"==typeof m.echoClient&&(this._stats=new n(m.echoClient,{namespace:this.namespace}));var o=this,s=m.alwaysOpen||!1,t=m.isPreferredLocationEnabled,u=m.isGeolocationEnabled;u="undefined"==typeof u?!0:u;var v={onError:function(){o.results.clear(),o.autoComplete.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onInputInteractionEnd:function(){o.coldStartDialog&&(o.coldStartDialog.remove(),o.coldStartDialog=void 0)},onLocation:function(a){o.message.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden"),o.selectLocation(a)},onActive:function(){o.isActive||(o.isActive=!0,a.emit(o.namespace+":controller:active"),o.container.addClass("ls-ui-ctrl-active"))},onGeolocationAvailable:function(){a.emit(o.namespace+":controller:geolocation:available"),o.container.addClass("ls-ui-ctrl-geolocation")},onSearchResults:function(){o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onAutoCompleteResults:function(){o.message.clear(),o.results.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onResultsClear:function(){o.message.clear(),o.results.clear(),o.coldStartDialog&&(o.coldStartDialog.remove(),o.coldStartDialog=void 0),o.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden")},onClose:function(){o.close()}};o.translations=m.translations,o.api=new b(m.api),o.container=m.container,o.preferredLocation=new c(o.api),o.bbcCookies=new d,o.cookies=new e,o.cookiesColdStartKey="locserv_uics",o.container.addClass("ls-ui-ctrl-primary").append(p.append(q)),o.isActive=void 0,a.on(o.namespace+":error",v.onError),a.on(o.namespace+":component:search:focus",v.onActive),a.on(o.namespace+":component:search:start",v.onActive),a.on(o.namespace+":component:geolocation:click",v.onActive),a.on(o.namespace+":component:search:clear",v.onInputInteractionEnd),a.on(o.namespace+":component:search:end",v.onInputInteractionEnd),a.on(o.namespace+":component:auto_complete:results",v.onInputInteractionEnd),a.on(o.namespace+":component:search:results",v.onSearchResults),a.on(o.namespace+":component:auto_complete:render",v.onAutoCompleteResults),a.on(o.namespace+":component:auto_complete:clear",v.onResultsClear),a.on(o.namespace+":component:search:clear",v.onResultsClear),a.on(o.namespace+":component:geolocation:start",v.onResultsClear),a.on(o.namespace+":component:geolocation:location",v.onLocation),a.on(o.namespace+":component:auto_complete:location",v.onLocation),a.on(o.namespace+":component:user_locations:location",v.onLocation),a.on(o.namespace+":component:search_results:location",v.onLocation),a.on(o.namespace+":component:geolocation:available",v.onGeolocationAvailable),a.on(o.namespace+":component:close_button:clicked",v.onClose),o.search=new f({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:q,locationName:m.locationName}),o.autoComplete=new i({api:this.api,translations:o.translations,eventNamespace:o.namespace,element:o.search.input,container:p}),o.message=new g({translations:o.translations,eventNamespace:o.namespace,container:p}),o.results=new j({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p}),u&&(o.geolocation=new h({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p})),o.userLocations=new k({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p,isPreferredLocationEnabled:t}),s?(o.container.addClass("ls-ui-ctrl-open"),v.onActive()):o.closeButton=new l({translations:o.translations,eventNamespace:o.namespace,container:p})}var p=a("<div />").addClass("ls-ui-o"),q=a("<div />").addClass("ls-ui-ctrl-primary-search"),r=function(a){for(var b=["api","translations","container"],c=b.length,d=0;c>d;d++){var e=b[d];if(!a[e])throw new Error("Primary Controller requires an "+e+" option.")}};return o.prototype.close=function(){this.isActive&&(this.isActive=!1,this.search.clear(),a.emit(this.namespace+":controller:inactive"),this.container.removeClass("ls-ui-ctrl-active"),this.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden"))},o.prototype.selectLocation=function(b){var c=this,d=function(){a.emit(c.namespace+":controller:location",[b])},e=function(){c.preferredLocation.set(b.id,{success:function(){a.emit(c.namespace+":controller:preferred_location",[b]),d()},error:function(){d()}})},f=function(){var a=new Date;a.setFullYear(a.getFullYear()+1),c.cookies.set(c.cookiesColdStartKey,"1",a.toUTCString(),"/",c.preferredLocation.getCookieDomain()),d()};this.preferredLocation.isValidLocation(b)&&this.shouldColdStartDialogBeDisplayed()?this.coldStartDialog=new m({container:p,translations:this.translations,message:c.translations.get("primary.cold_start",{name:b.name}),confirmLabel:c.translations.get("primary.cold_start.confirm"),cancelLabel:c.translations.get("primary.cold_start.cancel"),confirm:function(){c.coldStartDialog=void 0,e()},cancel:function(){c.coldStartDialog=void 0,f()}}):d()},o.prototype.shouldColdStartDialogBeDisplayed=function(){return!1===this.preferredLocation.isSet()&&!1===this.bbcCookies.isPersonalisationDisabled()&&this.cookies.isSupported()&&"1"!==this.cookies.get(this.cookiesColdStartKey)&&!0===this.userLocations.isPreferredLocationEnabled},o}),define(["jquery","locservices/core/api","locservices/core/preferred_location","locservices/core/bbc_cookies","locservices/core/cookies","locservices/ui/component/search","locservices/ui/component/message","locservices/ui/component/geolocation","locservices/ui/component/auto_complete","locservices/ui/component/search_results","locservices/ui/component/user_locations","locservices/ui/component/close_button","locservices/ui/component/dialog","locservices/ui/utils/stats"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(m){r(m),this.namespace=m.namespace||"locservices:ui","object"==typeof m.echoClient&&(this._stats=new n(m.echoClient,{namespace:this.namespace}));var o=this,s=m.alwaysOpen||!1,t=m.isPreferredLocationEnabled,u=m.isGeolocationEnabled;u="undefined"==typeof u?!0:u;var v={onError:function(){o.results.clear(),o.autoComplete.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onInputInteractionEnd:function(){o.coldStartDialog&&(o.coldStartDialog.remove(),o.coldStartDialog=void 0)},onLocation:function(a){o.message.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden"),o.selectLocation(a)},onActive:function(){o.isActive||(o.isActive=!0,a.emit(o.namespace+":controller:active"),o.container.addClass("ls-ui-ctrl-active"))},onGeolocationAvailable:function(){a.emit(o.namespace+":controller:geolocation:available"),o.container.addClass("ls-ui-ctrl-geolocation")},onSearchResults:function(){o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onAutoCompleteResults:function(){o.message.clear(),o.results.clear(),o.container.find(".ls-ui-comp-user_locations").addClass("ls-ui-hidden")},onResultsClear:function(){o.message.clear(),o.results.clear(),o.coldStartDialog&&(o.coldStartDialog.remove(),o.coldStartDialog=void 0),o.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden")},onClose:function(){o.close()}};o.translations=m.translations,o.api=new b(m.api),o.container=m.container,o.preferredLocation=new c(o.api),o.bbcCookies=new d,o.cookies=new e,o.cookiesColdStartKey="locserv_uics",o.container.addClass("ls-ui-ctrl-primary").append(p.append(q)),o.isActive=void 0,a.on(o.namespace+":error",v.onError),a.on(o.namespace+":component:search:focus",v.onActive),a.on(o.namespace+":component:search:start",v.onActive),a.on(o.namespace+":component:geolocation:click",v.onActive),a.on(o.namespace+":component:search:clear",v.onInputInteractionEnd),a.on(o.namespace+":component:search:end",v.onInputInteractionEnd),a.on(o.namespace+":component:auto_complete:results",v.onInputInteractionEnd),a.on(o.namespace+":component:search:results",v.onSearchResults),a.on(o.namespace+":component:auto_complete:render",v.onAutoCompleteResults),a.on(o.namespace+":component:auto_complete:clear",v.onResultsClear),a.on(o.namespace+":component:search:clear",v.onResultsClear),a.on(o.namespace+":component:geolocation:start",v.onResultsClear),a.on(o.namespace+":component:geolocation:location",v.onLocation),a.on(o.namespace+":component:auto_complete:location",v.onLocation),a.on(o.namespace+":component:user_locations:location",v.onLocation),a.on(o.namespace+":component:search_results:location",v.onLocation),a.on(o.namespace+":component:geolocation:available",v.onGeolocationAvailable),a.on(o.namespace+":component:close_button:clicked",v.onClose),o.search=new f({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:q,locationName:m.locationName}),o.autoComplete=new i({api:this.api,translations:o.translations,eventNamespace:o.namespace,element:o.search.input,container:p}),o.message=new g({translations:o.translations,eventNamespace:o.namespace,container:p}),o.results=new j({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p}),u&&(o.geolocation=new h({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p})),o.userLocations=new k({api:this.api,translations:o.translations,eventNamespace:o.namespace,container:p,isPreferredLocationEnabled:t}),s?(o.container.addClass("ls-ui-ctrl-open"),v.onActive()):o.closeButton=new l({translations:o.translations,eventNamespace:o.namespace,container:p})}var p=a("<div />").addClass("ls-ui-o"),q=a("<div />").addClass("ls-ui-ctrl-primary-search"),r=function(a){for(var b=["api","translations","container"],c=b.length,d=0;c>d;d++){var e=b[d];if(!a[e])throw new Error("Primary Controller requires an "+e+" option.")}};return o.prototype.close=function(){this.isActive&&(this.isActive=!1,this.search.clear(),a.emit(this.namespace+":controller:inactive"),this.container.removeClass("ls-ui-ctrl-active"),this.container.find(".ls-ui-comp-user_locations").removeClass("ls-ui-hidden"))},o.prototype.selectLocation=function(b){var c=this,d=function(){a.emit(c.namespace+":controller:location",[b])},e=function(){c.preferredLocation.set(b.id,{success:function(){d()},error:function(){d()}})},f=function(){var a=new Date;a.setFullYear(a.getFullYear()+1),c.cookies.set(c.cookiesColdStartKey,"1",a.toUTCString(),"/",c.preferredLocation.getCookieDomain()),d()};this.preferredLocation.isValidLocation(b)&&this.shouldColdStartDialogBeDisplayed()?this.coldStartDialog=new m({container:p,translations:this.translations,message:c.translations.get("primary.cold_start",{name:b.name}),confirmLabel:c.translations.get("primary.cold_start.confirm"),cancelLabel:c.translations.get("primary.cold_start.cancel"),confirm:function(){c.coldStartDialog=void 0,e()},cancel:function(){c.coldStartDialog=void 0,f()}}):d()},o.prototype.shouldColdStartDialogBeDisplayed=function(){return!1===this.preferredLocation.isSet()&&!1===this.bbcCookies.isPersonalisationDisabled()&&this.cookies.isSupported()&&"1"!==this.cookies.get(this.cookiesColdStartKey)&&!0===this.userLocations.isPreferredLocationEnabled},o});